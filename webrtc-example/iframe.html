<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <title>iframe</title>
      <script src="https://webxrpress.org/wp-includes/js/jquery/jquery.min.js"></script>
      <script src="iframe-messaging.js?"></script>
      <link rel="stylesheet" href="main.css" type="text/css" media="all">
      <script src="adapter.js"></script>
      <script>
        (function($) {
          $(function() {
              window.ifm = new IFrameMessaging();
              window.ifm.onReceiveMessage(function(data) {
                console.log(data);
                var el = document.createElement("p");
                var txtNode = document.createTextNode(data.message);
                el.appendChild(txtNode);
                let receiveBox = document.getElementById('receivebox');
                receiveBox.appendChild(el);
              });


              // var remoteConnection = null;
              // var receiveChannel = null;
              // ifm.onReceiveMessage(function(message) {

              //     // Ignore unrelated webrtc handshaking messages
              //     if (message.webrtc != true) return;

              //     console.log("in iFrame: received message: ");
              //     console.log(message);
              //     if (message.localDescription) {
              //       console.log("localDescription received!");
              //       remoteConnection = new RTCPeerConnection();
              //       remoteConnection.ondatachannel = function(event) {
              //         receiveChannel = event.channel;
              //         receiveChannel.onmessage = function(event) {
              //           var el = document.createElement("p");
              //           var txtNode = document.createTextNode(event.data);
              //           el.appendChild(txtNode);
              //           let receiveBox = document.getElementById('receivebox');
              //           receiveBox.appendChild(el);
              //         };
              //         receiveChannel.onopen = function() {
              //           console.log("receiveChannel.onopen fired!");
              //         };
              //         receiveChannel.onclose = function() {
              //           console.log("receiveChannel.onclose fired!");
              //         };
              //       };
              //       remoteConnection.setRemoteDescription(message.localDescription).then(function() {
              //         remoteConnection.createAnswer().then(function(answer) {
              //           console.log("Got answer in iframe remoteConnection.createAnswer");
              //           remoteConnection.setLocalDescription(answer).then(function() {
              //             ifm.sendMessage({
              //               webrtc: true, 
              //               remoteDescription: remoteConnection.localDescription.toJSON()
              //             });
              //           });
              //         });
              //       });
              //     }
              //     if (message.localCandidate) {
              //       remoteConnection.onicecandidate = function(e) {
              //           if (e.candidate) {
              //             ifm.sendMessage({
              //               webrtc: true, 
              //               remoteCandidate: e.candidate.toJSON()
              //             });
              //           }
              //       };
              //       remoteConnection.addIceCandidate(message.localCandidate).catch(function(e) {
              //         console.log("remoteConnection error: " + e.toString());
              //       });
              //     }
              //     if (message.localDisconnect) {
              //       receiveChannel.close();
              //       remoteConnection.close();
              //       receiveChannel = null;
              //       remoteConnection = null;
              //     }   
              // });
          });
        })(jQuery);
      </script>
    </head>
    <body>
        This is the iframe.<br/>
        <h1>MDN - WebRTC: Simple RTCDataChannel sample</h1>
        <div class="messagebox" id="receivebox">
          <p>Messages received:</p>
        </div>
    </body>
</html>