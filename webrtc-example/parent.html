<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Parent</title>
        <script src="https://webxrpress.org/wp-includes/js/jquery/jquery.min.js"></script>
        <script src="../js/iframe-messaging.js?123"></script>
        <link rel="stylesheet" href="main.css" type="text/css" media="all">
        <script src="adapter.js"></script>

        <script>
        (function($) {
          $(function() {
            setTimeout(function() {
              window.ifm = new IFrameMessaging();
              $("#sendButton").click(function() {
                window.ifm.sendMessage({message: $('#message').val()});
                $('#message').val('');
              });
              window.ifm.onReceiveMessage(function(data) {
                console.log(data);
                var el = document.createElement("p");
                var txtNode = document.createTextNode(data.message);
                el.appendChild(txtNode);
                let receiveBox = document.getElementById('receivebox');
                receiveBox.appendChild(el);
              });
            }, 1000);


            // var localConnection = null;   // RTCPeerConnection for our "local" connection
            // var sendChannel = null;
            // $("#connectButton").click(function() {
            //   localConnection = new RTCPeerConnection();
            //   sendChannel = localConnection.createDataChannel("sendChannel");
            //   sendChannel.onopen = function() {
            //     console.log("sendChannel.onopen fired!");
            //   };
            //   sendChannel.onclose = function() {
            //     console.log("sendChannel.onclose fired!");
            //   };
            //   localConnection.onicecandidate = function(e) {
            //     if (e.candidate) {
            //       ifm.sendMessage({ 
            //         webrtc: true, 
            //         localCandidate: e.candidate.toJSON()
            //       });
            //     }
            //   };
            //   localConnection.createOffer().then(function(offer) {
            //     return localConnection.setLocalDescription(offer);
            //   }).then(function() {
            //     ifm.sendMessage({
            //       webrtc: true, 
            //       localDescription: localConnection.localDescription.toJSON()
            //     });
            //   }).catch(function(e) {
            //     console.log("localConnection error: " + e.toString());
            //   });
            // });
            // $("#sendButton").click(function() {
            //     sendChannel.send($('#message').val());
            //     $('#message').val('');
            // });
            // $("#disconnectButton").click(function() {
            //   sendChannel.close();
            //   localConnection.close();
            //   sendChannel = null;
            //   localConnection = null;
            //   ifm.sendMessage({
            //     webrtc: true,
            //     localDisconnect: true
            //   });
            // });
            // ifm.onReceiveMessage(function(message) {

            //   // Ignore unrelated webrtc handshaking messages
            //   if (message.webrtc != true) return;

            //   if (message.remoteDescription) {
            //     localConnection.setRemoteDescription(message.remoteDescription);
            //   }
            //   if (message.remoteCandidate) {
            //     localConnection.addIceCandidate(message.remoteCandidate).catch(function(e) {
            //       console.log("ifm.ReceiveMessage error: " + e.toString());
            //     });
            //   }
            // });
          });
        })(jQuery);
        </script>
    </head>
    <body>
        This is the parent.<br/>
        <iframe id="theIFrame" src="./iframe.html?123" width="500px" height="320px"></iframe>

        <h1>MDN - WebRTC: Simple RTCDataChannel sample</h1>
        
        <div class="controlbox">
          <button id="connectButton" name="connectButton" class="buttonleft">
            Connect
          </button>
          <button id="disconnectButton" name="disconnectButton" class="buttonright">
            Disconnect
          </button>
        </div>
        
        <div class="messagebox">
          <label for="message">Enter a message:
            <input type="text" name="message" id="message" placeholder="Message text" 
                    inputmode="latin" size=60 maxlength=4096>
          </label>
          <button id="sendButton" name="sendButton" class="buttonright">
            Send
          </button>
        </div>
        <div class="messagebox" id="receivebox">
          <p>Messages received:</p>
        </div>
    </body>
</html>
